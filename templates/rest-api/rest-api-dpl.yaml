apiVersion: extensions/v1beta1
kind: Deployment
metadata:
  name: {{ .Release.Name }}-rest-api
  namespace: {{ .Release.Namespace }}
spec:
  replicas: 1
  template:
    metadata:
      labels:
        name: {{ .Release.Name }}-rest-api
    spec:
      containers:
      - name: {{ .Values.rest_api.name }}
        image: {{ .Values.rest_api.image.repository }}:{{ .Values.rest_api.image.tag }}
        ports:
        - name: api
          containerPort: 8008
        command:
        - bash
        args:
        - -c
        - "sawtooth-rest-api \
           -C tcp://{{ .Release.Name }}-validator:4004 -B 0.0.0.0:8008 \
{{- if .Values.opentsdb.db }}
           --opentsdb-db {{ .Values.opentsdb.db }} \
{{- end }}
{{- if .Values.opentsdb.url }}
           --opentsdb-url {{ .Values.opentsdb.url }} \
{{- end }}
        "